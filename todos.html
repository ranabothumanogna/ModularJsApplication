<!-- todos.html -->
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Todos - MyApp</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="root"></div>

  <script type="module">
    import { createNavbar } from './navbar.js';
    import { createFooter } from './footer.js';
    import { getCurrentUser, logout } from './auth.js';
    import { displayTodos } from './displaytodos.js';


    const root = document.getElementById('root');
    root.appendChild(createNavbar());

    const main = document.createElement('main');
    main.className = 'container';
    main.innerHTML = `
      <div class="top-row">
        <h1>Todos</h1>
        <div>
          <button id="logoutBtn">Logout</button>
        </div>
      </div>
      <div id="todosContainer">Loading todos...</div>
    `;
    root.appendChild(main);
    root.appendChild(createFooter());

    // Auth guard
    const current = getCurrentUser();
    if (!current) {
      // not logged in -> go to login
      window.location.href = 'login.html';
      throw new Error('Redirecting to login');
    }

    document.getElementById('logoutBtn').addEventListener('click', () => {
      logout();
      window.location.href = 'login.html';
    });

    const todosContainer = document.getElementById('todosContainer');

    // fetch todos
    fetch('https://jsonplaceholder.typicode.com/todos')
      .then(res => {
        if (!res.ok) throw new Error('Network response not ok');
        return res.json();
      })
      .then(data => {
        displayTodos(data, todosContainer);
      })
      .catch(err => {
        todosContainer.textContent = 'Unable to load todos: ' + err.message;
      });
  </script>
</body>
</html>
