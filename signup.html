<!-- signup.html -->
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Signup - MyApp</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="root"></div>

  <script type="module">
    import { createNavbar } from './navbar.js';
    import { createFooter } from './footer.js';
    import { saveUser, findUserByEmail, setCurrentUser } from './auth.js';

    const root = document.getElementById('root');
    root.appendChild(createNavbar());

    const main = document.createElement('main');
    main.className = 'container';
    main.innerHTML = `
      <h1>Signup</h1>
      <form id="signupForm">
        <label>
          Name<br /><input name="name" required />
        </label><br />
        <label>
          Email<br /><input name="email" type="email" required />
        </label><br />
        <label>
          Password<br /><input name="password" type="password" required minlength="6" />
        </label><br />
        <button type="submit">Create account</button>
      </form>
      <div id="msg"></div>
    `;
    root.appendChild(main);
    root.appendChild(createFooter());

    const form = main.querySelector('#signupForm');
    const msg = main.querySelector('#msg');

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const formData = new FormData(form);
      const name = formData.get('name').trim();
      const email = formData.get('email').trim();
      const password = formData.get('password');

      if (findUserByEmail(email)) {
        msg.textContent = 'An account with that email already exists.';
        msg.style.color = 'red';
        return;
      }

      saveUser({ name, email, password });
      setCurrentUser(email);
      // on successful signup, go to todos
      window.location.href = 'todos.html';
    });
  </script>
</body>
</html>
